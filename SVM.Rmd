---
title: "SVM"
author: "Elizabeth Saline"
date: "5/2/2020"
output: html_document
---

```{r warning = F, message = F}

rm(list = ls())

# Load in packages
library(tidyverse)
library(knitr)
library(ISLR)
library(e1071)


# Read in training and testing data
model_test <- 
  readRDS("./Data/model_test.RDS") 
model_train <- 
  readRDS("./Data/model_train.RDS")
```

## SVM


**** General Description of SVM method

### SVC for H1N1 (linear)

```{r}
#SVM for H1N1
h1n1_train <- model_train
h1n1_train[,c("seasonal_vaccine")] <- list(NULL)
h1n1_test <- model_test
h1n1_test[,c("seasonal_vaccine")] <- list(NULL)
#SVC
set.seed(140)
h1n1_train$h1n1_vaccine <- as.factor(model_train$h1n1_vaccine)
svc.fit <- svm(h1n1_vaccine~., data=h1n1_train,kernel="linear",cost=0.01)
summary(svc.fit)
```

```{r}

train.pred <- predict(svc.fit, h1n1_train)
table(h1n1_train$h1n1_vaccine,train.pred)
(8606+1308)/11963
```

Training error rates.....

```{r}

test.pred <- predict(svc.fit, h1n1_test)
table(h1n1_test$h1n1_vaccine, test.pred)
(5771+843)/7973

```

Test error rates, sensitivity, specificity....

### SVM for H1N1 (radial)
```{r}

#SVM with radial kernel
set.seed(140)
svm.fit <- svm(h1n1_vaccine~.,data=h1n1_train, kernel="radial")
summary(svm.fit)
```

```{r}
train.pred <- predict(svm.fit, h1n1_train)
table(h1n1_train$h1n1_vaccine,train.pred)
(8726+1338)/11963
```

```{r}
test.pred <- predict(svm.fit, h1n1_test)
table(h1n1_test$h1n1_vaccine, test.pred)
(5795+799)/7973
```

### SVM for H1N1 (polynomial)
```{r}

#SVM with polynomial kernel
set.seed(140)
svm.fit <- svm(h1n1_vaccine ~ ., data = h1n1_train, kernel = "poly", degree = 2)
summary(svm.fit)
```

```{r}
train.pred <- predict(svm.fit, h1n1_train)
table(h1n1_train$h1n1_vaccine,train.pred)
(8717+1267)/11963
```

```{r}
test.pred <- predict(svm.fit, h1n1_test)
table(h1n1_test$h1n1_vaccine, test.pred)
(5830+772)/7973
```


### SVM for Seasonal Flu (linear)
```{r}

#SVM for Seasonal
seasonal_train <- model_train
seasonal_train[,c("h1n1_vaccine")] <- list(NULL)
seasonal_test <- model_test
seasonal_test[,c("h1n1_vaccine")] <- list(NULL)
#SVC
set.seed(140)
seasonal_train$seasonal_vaccine <- as.factor(seasonal_train$seasonal_vaccine)
svc.fit <- svm(seasonal_vaccine~., data=seasonal_train,kernel="linear",cost=0.01)
summary(svc.fit)
```

```{r}
train.pred <- predict(svc.fit, seasonal_train)
table(seasonal_train$seasonal_vaccine,train.pred)
(5104+4265)/11963
```

```{r}
test.pred <- predict(svc.fit, model_test)
table(model_test$seasonal_vaccine, test.pred)
(3384+2828)/7973
```

### SVM for Seasonal Flu (radial)
```{r}

#SVM with radial kernel
set.seed(140)
svm.fit <- svm(seasonal_vaccine~.,data=seasonal_train, kernel="radial")
summary(svm.fit)
```

```{r}
train.pred <-  predict(svm.fit, seasonal_train)
table(seasonal_train$seasonal_vaccine, train.pred)
(5207+4455)/11963
```

```{r}
test.pred <- predict(svm.fit, seasonal_test)
table(seasonal_test$seasonal_vaccine, test.pred)
(3393+2859)/7973
```

### SVM for Seasonal Flu (polynomial)
```{r}
#SVM with polynomial kernel
set.seed(140)
svm.fit <- svm(seasonal_vaccine ~ ., data = seasonal_train, kernel = "poly", degree = 2)
summary(svm.fit)
```

```{r}
train.pred <-  predict(svm.fit, seasonal_train)
table(seasonal_train$seasonal_vaccine, train.pred)
(5223+4265)/11963

```

```{r}
test.pred <- predict(svm.fit, seasonal_test)
table(seasonal_test$seasonal_vaccine, test.pred)
(3427+2762)/7973

```



For the H1N1 vaccinations, SVC had a predictive ability of 82.9%, which accounts for a training error rate of 17.1%.  The test error rate was 17%, which means that the testing prediction rate was 83%.  Radial SVM had a test prediction rate of 82.7%, giving an error rate of 17.3%.  The SVM with a polynomial kernel had a test error rate of 17.2%, which is the highest of the three models.  The test prediction rate was 82.8%. For the seasonal vaccinations, the SVC showed a prediction rate of 77.9%, SVM with radial and polynomial kernels had prediction rates of 78.4% and 77.6% respectively.  

Taken all together, the range across the 6 models was small. SVC predicted H1N1 best, but SVM with a radial kernel predicted seasonal vaccine best.